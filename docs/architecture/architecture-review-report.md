---
marp: true
theme: default
paginate: true
header: 'TubeWiki - Architecture Review Report'
footer: 'Â© 2025 TubeWiki'
---

# TubeWiki Architecture Review Report

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å®Ÿè£…çŠ¶æ³ã¨æœ€é©åŒ–ã®æˆæœ**

2025-12-03

---

## ğŸ“Š ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¦‚è¦

### ç›®çš„
`docs/architecture.md` ã§å®šç¾©ã•ã‚ŒãŸã€Œæœ€é©åŒ–ã•ã‚ŒãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã¨ã€ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…çŠ¶æ³ã‚’æ¯”è¼ƒãƒ»è©•ä¾¡ã—ã€ä»Šå¾Œã®æŒ‡é‡ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚

### å¯¾è±¡ç¯„å›²
- Core Service (Backend)
- Worker Service (Background Jobs)
- Extension (Frontend)
- Shared Libraries

### çµè«–
**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŸºç›¤æ§‹ç¯‰ï¼ˆPhase 1 & 2ï¼‰ã¯å®Œäº†ã—ã€è¨­è¨ˆé€šã‚Šã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã€‚**
ç‰¹ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ­ã‚®ãƒ³ã‚°ã€å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®æ•´å‚™ã«ã‚ˆã‚Šã€å …ç‰¢æ€§ãŒå¤§å¹…ã«å‘ä¸Šã—ãŸã€‚

---

## âœ… å®Ÿè£…æ¸ˆã¿é …ç›® (Phase 1 & 2)

### 1. å…±æœ‰ã‚¤ãƒ³ãƒ•ãƒ© (Shared Infrastructure)
- **ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚¯ãƒ©ã‚¹**: `shared/utils/exceptions.py` ã«15ç¨®é¡ä»¥ä¸Šã®ä¾‹å¤–ã‚’å®šç¾©ã€‚ã‚¨ãƒ©ãƒ¼ã®ç²’åº¦ãŒæ˜ç¢ºåŒ–ã€‚
- **ãƒ­ã‚®ãƒ³ã‚°**: `shared/utils/logger.py` ã§æ§‹é€ åŒ–ãƒ­ã‚°ã¨ã‚«ãƒ©ãƒ¼å‡ºåŠ›ã‚’å®Ÿè£…ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã«ã‚ˆã‚‹è¿½è·¡ãŒå¯èƒ½ã«ã€‚
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: `shared/utils/validators.py` ã§YouTube URLã€Emailã€Tokenç­‰ã®æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ±ä¸€ã€‚
- **ãƒªãƒˆãƒ©ã‚¤å‡¦ç†**: `shared/utils/retry.py` ã§æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•æ©Ÿèƒ½ä»˜ãã®ãƒªãƒˆãƒ©ã‚¤ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’å®Ÿè£…ã€‚

### 2. Core API Service
- **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å°å…¥**:
  - `error_handler.py`: å…¨ä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒã—ã€çµ±ä¸€ã•ã‚ŒãŸJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã€‚
  - `logging.py`: å…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¨ˆæ¸¬ãƒ»ãƒ­ã‚°è¨˜éŒ²ã€‚
  - `rate_limit.py`: `slowapi` ã‚’ä½¿ç”¨ã—ãŸãƒ¬ãƒ¼ãƒˆåˆ¶é™ (100 req/min) ã‚’å®Ÿè£…ã€‚
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: è©³ç´°ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¿”ã™ `/healthz` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æ•´å‚™ã€‚

---

### 3. Worker Service
- **å …ç‰¢æ€§å‘ä¸Š**:
  - `YouTubeService` ã«ãƒªãƒˆãƒ©ã‚¤ (`@with_retry`) ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (`@timeout`) ã‚’é©ç”¨ã€‚
  - å¤–éƒ¨APIã‚¨ãƒ©ãƒ¼ (`YouTubeAPIError`) ã¨ãƒ‡ãƒ¼ã‚¿ä¸åœ¨ (`TranscriptNotAvailableError`) ã‚’æ˜ç¢ºã«åŒºåˆ¥ã€‚

### 4. Chrome Extension
- **ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒª**: `ErrorBoundary` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã€Reactãƒ„ãƒªãƒ¼å…¨ä½“ã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’é˜²æ­¢ã€‚
- **Export Bar**: `ExportBar` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã—ã€Shadow DOMã«ã‚ˆã‚‹ã‚¹ã‚¿ã‚¤ãƒ«éš”é›¢ã‚’å®Ÿç¾ã€‚

---

## ğŸ”„ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é©åˆåº¦ãƒã‚§ãƒƒã‚¯

| è¨­è¨ˆè¦ç´  | å®Ÿè£…çŠ¶æ³ | è©•ä¾¡ | å‚™è€ƒ |
| :--- | :---: | :---: | :--- |
| **Clean Architecture** | âœ… | é«˜ | ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢ï¼ˆAPI/Service/Sharedï¼‰ãŒéµå®ˆã•ã‚Œã¦ã„ã‚‹ |
| **Microservices** | âœ… | é«˜ | Core/Worker/ExtensionãŒç–çµåˆã«ä¿ãŸã‚Œã¦ã„ã‚‹ |
| **Error Handling** | âœ… | é«˜ | çµ±ä¸€ã•ã‚ŒãŸä¾‹å¤–ã‚¯ãƒ©ã‚¹ã¨ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ç®¡ç† |
| **Security** | âš ï¸ | ä¸­ | èªè¨¼ãƒ»èªå¯ã¯å®Ÿè£…æ¸ˆã¿ã ãŒã€è©³ç´°ãªãƒ­ãƒ¼ãƒ«ç®¡ç†ã¯ä»Šå¾Œ |
| **Observability** | âœ… | é«˜ | æ§‹é€ åŒ–ãƒ­ã‚°ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDè¿½è·¡ãŒå°å…¥æ¸ˆã¿ |
| **Scalability** | âœ… | é«˜ | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¨éåŒæœŸå‡¦ç†ã«ã‚ˆã‚Šè² è·è€æ€§ãŒå‘ä¸Š |

---

## ğŸ“‰ æ®‹èª²é¡Œã¨æ¨å¥¨äº‹é …

### 1. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº (Export Features)
- **ç¾çŠ¶**: ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ã¿å®Ÿè£…æ¸ˆã¿ã€‚
- **èª²é¡Œ**: Notion, GitHub, Obsidiané€£æºãŒæœªå®Ÿè£…ã€‚
- **æ¨å¥¨**: `docs/architecture.md` ã® "Phase 2" ã«å¾“ã„ã€å„APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ `extension/src/lib/` ã¾ãŸã¯ `worker/services/` ã«å®Ÿè£…ã™ã‚‹ã€‚

### 2. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
- **ç¾çŠ¶**: åŸºç›¤ã‚³ãƒ¼ãƒ‰ã¯æ•´å‚™ã•ã‚ŒãŸãŒã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒè¿½ã„ã¤ã„ã¦ã„ãªã„å¯èƒ½æ€§ã€‚
- **æ¨å¥¨**: æ–°ã—ãä½œæˆã—ãŸ `shared/utils` ã‚„ `core/middleware` ã«å¯¾ã™ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹ã€‚

### 3. è¨­å®šç®¡ç† (Configuration)
- **ç¾çŠ¶**: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¨ `os.getenv` ãŒæ•£åœ¨ã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã€‚
- **æ¨å¥¨**: `pydantic.BaseSettings` ã‚’ä½¿ç”¨ã—ãŸå‹å®‰å…¨ãªè¨­å®šç®¡ç†ã‚¯ãƒ©ã‚¹ (`shared/config.py`) ã«çµ±ä¸€ã™ã‚‹ã€‚

---

## ğŸš€ ä»Šå¾Œã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—æ¡ˆ

### Phase 3: Exportæ©Ÿèƒ½ã®æ‹¡å…… (Current Priority)
1. Notion APIé€£æºã®å®Ÿè£…
2. GitHub APIé€£æºã®å®Ÿè£…
3. Obsidian URIã‚¹ã‚­ãƒ¼ãƒ é€£æºã®å®Ÿè£…
4. è¨­å®šç”»é¢ (Popup) ã®ä½œæˆ

### Phase 4: å“è³ªã¨ä¿¡é ¼æ€§
1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®æ‹¡å…… (Coverage > 80%)
2. E2Eãƒ†ã‚¹ãƒˆã®å°å…¥ (Playwrightç­‰)
3. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ•´å‚™

### Phase 5: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
1. Redisã®å°å…¥ (ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®æ°¸ç¶šåŒ–ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥)
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–

---

## ğŸ“ çµè«–

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ·æ–°ã¯æˆåŠŸã—ã¾ã—ãŸã€‚**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç¾åœ¨ã€**ã€Œæ©Ÿèƒ½è¿½åŠ ã«è€ãˆã†ã‚‹å …ç‰¢ãªåŸºç›¤ã€**ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾¡å€¤ã«ç›´çµã™ã‚‹**ã€Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®æ‹¡å……ã€**ã«æ³¨åŠ›ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

> **Next Action**: `Implementing Export Bar - Phase 2` (Notion/GitHub/Obsidiané€£æº) ã¸ç§»è¡Œ
